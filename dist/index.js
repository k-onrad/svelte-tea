"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useModel=exports.provideModel=exports.withMiddleware=exports.createModel=void 0;var svelte_1=require("svelte"),store_1=require("svelte/store"),MODELKEY="undefined"!=typeof Symbol?Symbol("svelte-tea/model"):"svelte-tea/model";function isObjNotProp(e){return"object"==typeof e&&null!==e}function hasProp(e,r){return r in e}var createModel=function(e){return function(r){var t=store_1.writable(r),o=t.subscribe,n=t.update;return{subscribe:o,dispatch:function(r){n(e(r))}}}};exports.createModel=createModel;var withMiddleware=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(r){return function(t){var o=exports.createModel(r)(t);if(!Array.isArray(e)||0===e.length)return o;var n=function(e){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},i={getState:function(){return store_1.get(o)},dispatch:function(e){return n(e)}};return n=e.map((function(e){return e(i)})).reduce((function(e,r){return r(e)}),o.dispatch),__assign(__assign({},o),{dispatch:n})}}};exports.withMiddleware=withMiddleware;var provideModel=function(e){svelte_1.setContext(MODELKEY,e)};exports.provideModel=provideModel;var useModel=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=svelte_1.getContext(MODELKEY);if(null==t)throw new Error('Context not found. Please ensure you provide the model using "provideModel" function');var o=store_1.derived(t,(function(r){return e.reduce((function(e,r){if(isObjNotProp(e)&&hasProp(e,r))return e[r];throw new Error("Model or node of model "+JSON.stringify(e)+" does not have property "+r)}),r)}));return[o,t.dispatch]};exports.useModel=useModel;